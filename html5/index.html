<html>
	<head>
	
		<style>
			body {
				/*
				background-color: #1e1e1e;
				color: #a086f0;
				*/
			}
		
			textarea {
				width: 100%;
			}
			
			.tests table {
				width: 100%;
				padding-left: 50px;
				padding-right: 50px;
				border-collapse: collapse;
			}
			
			.tests td {
				border: 1px solid blue;
				
			}
			
			.tests th {
				background-color: aliceblue;
			}
		</style>
	
		<script src="utils.js"></script>
		<script src="Tests.js"></script>
		<script src="Loader.js"></script>

		<script>

			function fetch_script(url) {
				return new Promise(function(resolve, reject) {
					var script = document.createElement("script");
					script.type = "text/javascript";
					script.onload = function () {
						resolve(script);
					};
					script.src = url /* + "?now=" + Date.now()*/;
					document.head.appendChild(script);
				});
			}

			async function main() {
				response = await fetch("../build/untouched.wasm");
				//buffer = await response.arrayBuffer();
				
				imports = {};
				
				/*
				imports.env = {};
				imports.env.memoryBase = 0;
				imports.env.tableBase = 0;
				if (!imports.env.memory) {
					imports.env.memory = new WebAssembly.Memory({ initial: 20 });
				}
				if (!imports.env.table) {
					imports.env.table = new WebAssembly.Table({ initial: 0, element: 'anyfunc' });
				}
				*/
				
				//module = Loader.instantiateBuffer(buffer, imports);
				module = await Loader.instantiateStreaming(response, imports);
				
				//console.log(module.I8.length);
				
				// next three lines just test the auto-generated demangled class, which isn't so useful currently
				// this PR might change it: https://github.com/AssemblyScript/assemblyscript/pull/437
				// a = new module.Vec3(1,2,3)
				// b = new module.Vec3(11,22,33)
				// console.log("a.add(b)", a.add(b)); // returns no class but a raw pointer
				
				pc = {}; // namespace for all pc_*.js files
				await fetch_script("pc_mat3.js");
				await fetch_script("pc_mat4.js");
				await fetch_script("pc_quat.js");
				await fetch_script("pc_vec2.js");
				await fetch_script("pc_vec3.js");
				await fetch_script("pc_vec4.js");
				
				tests_init();
			}

			main().then(function() {
				console.log("main() called");
			});

		</script>
	</head>
	<body>
	
		<p>Vec2 stuff</p>
		
		<div class="tests">
			<table>
				<tr>
					<td>
						var v = new pc.Vec2(1, 2);
						v.toString() == "[1, 2]";
			</table>
		</div>
		
		<p>Vec3 stuff</p>
		
		<div class="tests">
			<table>
				<tr>
					<td>
						var v = new pc.Vec3(1, 2, 3);
						v.toString() == "[1, 2, 3]";
			</table>
		</div>
		
		<p>Vec4 stuff</p>
		
		<div class="tests">
			<table>
				<tr>
					<td>
						var v = new pc.Vec4(1, 2, 3, 4);
						v.toString() == "[1, 2, 3, 4]";
			</table>
		</div>
		
		<p>Quat stuff</p>
		
		<div class="tests">
			<table>
				<tr>
					<td>
						var q = new pc.Quat(1,2,3,4);
						q.toString() == "[1, 2, 3, 4]";
				<tr>
					<td>
						var a = new pc.Quat(1,2,3,4);
						var b = new pc.Quat(1,2,3,4);
						a.equals(b);
				<tr>
					<td>
						var q = new pc.Quat(1, 2, 3, 4);
						q.conjugate();
						q.toString() == "[-1, -2, -3, 4]";
				<tr>
					<td>
						var q = new pc.Quat(0.1, 0.2, 0.3, 0.4);
						var v = new pc.Vec3();
						var angle = q.getAxisAngle(v);
						angle == 132.84364304359633;
			</table>
		</div>
	</body>
</html>
